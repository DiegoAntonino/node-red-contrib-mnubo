<script type="text/javascript">
   RED.nodes.registerType('mnubo events',{
      category: 'SmartObjects',
      color: '#00a1e0',
      defaults: {
            name: {value:""},
            mnuboconfig: {value: "", type: "mnubo config", required: true},
            functionselection: {value: "send", required: true},
            inputtext: {value: "",type: 'text'},
            reportResults: {value: false},
            objectsMustExist: {value: false},
      },
      inputs:1,
      outputs:1,
      icon: "Events.png",
      align: "left",
      label: function() {
            return this.name||"event "+this.functionselection;
      },
      labelStyle: function() {
            return this.name?"node_label_italic":"";
      },
      button: {
         onclick: function() {
               var label = this.name||"button";
               var node = this;
               $.ajax({
                  url: "events/"+this.id+"/button",
                  type:"POST",
                  success: function(resp, textStatus, xhr) {
                     RED.notify(node._("local injection",{label:label}),"success");
                  },
                  error:  function(resp, textStatus, xhr) {
                     RED.notify(node._("local injection",{label:label}),"error");
                  }
               });
         }
      },
   });
</script>

<script type="text/x-red" data-template-name="mnubo events">
   <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
   </div>
   <div class="form-row">
      <label for="node-input-mnuboconfig"><i class="fa fa-database"></i> mnubo config</label>
      <input type="text" id="node-input-mnuboconfig">
   </div>
   <div class="form-row">
      <label for="node-input-functionselection"><i class="fa fa-list"></i> Function</label>
         <select type="text" id="node-input-functionselection">
            <option value="send">Send</option>
            <option value="sendfromdevice">SendFromDevice</option>
         </select>
   </div>
   <div class="form-row">
      <input type="checkbox" id="node-input-reportResults" style="display: inline-block; width: auto; vertical-align: top;">
      <label for="node-input-reportResults">Report Results</label>
   </div>
   <div class="form-row">
      <input type="checkbox" id="node-input-objectsMustExist" style="display: inline-block; width: auto; vertical-align: top;">
      <label for="node-input-objectsMustExist">Objects Must Exist</label>
   </div>
   <div class="form-row">
      <label for="node-input-inputtext"><i class="fa fa-pencil"></i> Input</label>
      <textarea id="node-input-inputtext" rows="10" cols="80" placeholder="optional input string"></textarea>
   </div>
</script>

<script type="text/x-red" data-help-name="mnubo events">
    <p>This is a mnubo's SmartBojects Ingestion Event node.</p>
    <p>FUNCTIONS</p>
    <ul>
       <li><b>Send:</b> The input is a valid JSON which contain "x_device_id".</li>
       <li><b>SendFromDevice:</b> The input is an array with the following 2 elements:</li>
       <ul>
          <li>x_device_id</li>
          <li>JSON body</li>
       </ul>
    </ul>
    <p>INPUTS</p>
    <ul>
       <li>you can press the button to inject the input, using this node optional input</li>
       <li>you can inject the input of a msg.payload</li>
    </ul>

    <p>OUTPUTS</p>
    <ul>

       <li>The straight response coming from SmartObject Platform can be found on 'msg.payload'</li>
       <li>If <u>Report Result</u> flag is set to 'true', you can also refer to 'msg.errors' in order to check the error_message and the original event that has produced the error.</li>
    </ul>

    <p>REQUIREMENTS</p>
    <ol>
       <li> Mnubo configuration, with the following parameters:</li>
       <ul>
          <li>
             <b>Environment</b> that can be:
             <ul>
                <li>
                   <b>sandbox:</b> to connect to the mnubo's SmartObjects sandbox system.
                </li>
                <li>
                   <b>production:</b> to connect to the mnubo's SmartObjects production system.
                </li>
                <li>
                   <b>use Proxy URL:</b> If you need to connect to an alternate system, or you need to go through a proxy, you can use this field, it need to be a valid format (http://hostname:port).
                </li>
             </ul>
          <li>
             <b>Client ID</b> need to be a valid Client's Key.
          </li>
          <li>
             <b>Client Secret</b> need to be the valid Client's Secret.
          </li>
       </ul>
       <p></p>
       <li> Report Results (OPTIONAL)</li>
       This flag can be added to indicate if event results are returned. When this flag is not used, it behaves as set to false.
       <p></p>
       <li> Objects Must Exist (OPTIONAL)</li>
       This flag can be added to ensure an Object exists before registering the event. If this flag is not used, it behaves as set to false.
    </ol>
    <p>Refer to SmarObject's online documentation (under the API section) for details about this interface usage.</p>
    <p>To use the mnubo's SmartObjects nodes, you will need to have a valid mnubo account, with access granted on a namespace.  To obtain your unique namespace in the SmartObjects platform, contact sales@mnubo.com . Please use the subject title <b>node-red-contrinb-mnubo</b> and include in the body of the email the name of your company, contact name and phone number.</p>
</script>
