# node-red contrib mnubo

This is the implementation of the mnubo's SmartObjects functionality in the node-red environment.

## Requirements

This is a node-red package, so it requires node-red, The minimum version of node-red supported is v0.10.10

To use the mnubo's SmartObjects nodes, you will need to have a valid mnubo account, with access granted on a namespace.
To obtain your unique namespace in the SmartObjects platform, contact sales@mnubo.com . Please use the subject title **node-red-contrinb-mnubo** and include in the body of the email the name of your company, contact name and phone number.

Once logged into mnubo's SmartObjects, the Official reference API can be found in the following: [API documentation](https://sop.mtl.mnubo.com/apps/doc/?i=t).

This package also requires the following package:
- mnubo's SmartObjects Javascript SDK [mnubo-js-sdk](https://github.com/mnubo/mnubo-js-sdk)
- ECMAScript 6 (Harmony) compatibility shims for legacy JavaScript engines [es6-shim](https://www.npmjs.com/package/es6-shim)

Those packages will be installed automatically by npm, as they are dependent packages.


## Installation

    sudo npm install --prefix ~/.node-red node-red-contrib-mnubo
    
## Windows installation (using Cygwin)

    npm install --prefix ~/.node-red node-red-contrib-mnubo
    mkdir %homepath%/.node-red/nodes
    cp -rp %homepath%/node_modules/node-red-contrib-mnubo %homepath%/.node-red/nodes/

## Usage

In node red, all the nodes are under the category (**Mnubo**).  Detailed info is available on the individual node.
Here is a brief description of the nodes:
- `SmartObjects config`: This is the Configuration Node that holds the mnubo's SmartObjects credential, all nodes need to have this configured.
- `SmartObjects auth`: This node is used to fetch the access token for communication, with SmartObject, this node, you will allow you to get the status about the token.
- `SmartObjects owners` : This node is used to handle the Owners Ingestion API: `Create`, `Update`, `Delete`, `Claim Object`
- `SmartObjects objects` : This node is used to handle the Objectd Ingestion API: `Create`, `Update`, `Delete`
- `SmartObjects events` : This node is used to handle the Events Ingestion API: `Send`, `SendFromDevice`
- `SmartObjects analytics` : This node is used to handle the Search API: `getDataset`, `getDatamodel`, `SearchQurery`

## Examples

Here is a quick demo that show how to authenticate, create owner, update owner, create object, update object, send event, do a basicSearchQuery, delete the object, delete the owner:
```
[{"id":"ec6f6c42.13909","type":"mnubo config","z":"7eca5e06.8135a","name":"Casa","env":"sandbox","proxy_url":"https://rest.sandbox.mnubo.com:443"},{"id":"1493bc1c.eb6c44","type":"SmartObjects auth","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","x":441,"y":50,"wires":[["c960a6e0.369f58"]]},{"id":"4a36248d.b5c9dc","type":"inject","z":"7eca5e06.8135a","name":"","topic":"Test12","payload":"","payloadType":"none","repeat":"","crontab":"","once":false,"x":98,"y":51,"wires":[["1493bc1c.eb6c44"]]},{"id":"acddb7f2.532248","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":925,"y":188,"wires":[]},{"id":"c960a6e0.369f58","type":"switch","z":"7eca5e06.8135a","name":"Token != Bearer","property":"payload.token_type","rules":[{"t":"neq","v":"Bearer"},{"t":"eq","v":"Bearer"}],"checkall":"true","outputs":2,"x":647,"y":51,"wires":[["d7f0dab5.280f28"],["6da9f489.92560c","cc161a0d.33e9e8"]]},{"id":"f6ced9a3.093128","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":926,"y":157,"wires":[]},{"id":"97ea51fd.6815b","type":"SmartObjects owners","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"create","inputtext":"","x":496,"y":163,"wires":[["1ac7e9da.e53816"]]},{"id":"86726b8a.798d98","type":"SmartObjects owners","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"delete","inputtext":"","x":488,"y":839,"wires":[["f9b3e9bc.064c18"]]},{"id":"1ac7e9da.e53816","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":685,"y":164,"wires":[["f6ced9a3.093128"],["acddb7f2.532248","a71ae1b7.58e52"]]},{"id":"107fc713.ef8039","type":"change","z":"7eca5e06.8135a","name":"","rules":[{"t":"set","p":"payload","to":"node-red-auto1@test.com"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":839,"wires":[["86726b8a.798d98"]]},{"id":"d7f0dab5.280f28","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":933,"y":38,"wires":[]},{"id":"6da9f489.92560c","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":931,"y":70,"wires":[]},{"id":"9006d790.6ff928","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":917,"y":832,"wires":[]},{"id":"a4bff401.5b4008","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":914,"y":864,"wires":[]},{"id":"2bb11e02.d44ee2","type":"inject","z":"7eca5e06.8135a","name":"","topic":"clean","payload":"node-red-auto1@test.com","payloadType":"none","repeat":"","crontab":"","once":false,"x":91,"y":839,"wires":[["107fc713.ef8039"]]},{"id":"5961f877.a69e08","type":"inject","z":"7eca5e06.8135a","name":"","topic":"","payload":"","payloadType":"none","repeat":"","crontab":"","once":false,"x":99,"y":163,"wires":[["cc161a0d.33e9e8"]]},{"id":"f9b3e9bc.064c18","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":708,"y":834,"wires":[["9006d790.6ff928"],["a4bff401.5b4008"]]},{"id":"55802a44.aa7fd4","type":"SmartObjects owners","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"update","inputtext":"","x":486,"y":238,"wires":[["b153b5bb.4eac48"]]},{"id":"1b219be.fe4de64","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":925,"y":262,"wires":[]},{"id":"7e0286c6.81fd78","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":925,"y":230,"wires":[]},{"id":"b153b5bb.4eac48","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":755,"y":237,"wires":[["7e0286c6.81fd78"],["1b219be.fe4de64","ec0469f8.13fb98"]]},{"id":"65405b9.f9abfa4","type":"SmartObjects objects","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"create","inputtext":"","x":485,"y":323,"wires":[["e0e1cf65.1f1e3"]]},{"id":"e0e1cf65.1f1e3","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":690,"y":322,"wires":[["286be3a7.d7941c"],["ddd8c47c.222738","fa88f7b.f057708"]]},{"id":"286be3a7.d7941c","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":924,"y":309,"wires":[]},{"id":"ddd8c47c.222738","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":924,"y":341,"wires":[]},{"id":"6deed747.921128","type":"SmartObjects objects","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"delete","inputtext":"","x":484,"y":761,"wires":[["40f9eb13.bf0614"]]},{"id":"8d4caaf5.72b358","type":"inject","z":"7eca5e06.8135a","name":"","topic":"clean","payload":"node-red-auto1@test.com","payloadType":"none","repeat":"","crontab":"","once":false,"x":92,"y":763,"wires":[["9ce667ed.631998"]]},{"id":"9ce667ed.631998","type":"change","z":"7eca5e06.8135a","name":"","rules":[{"t":"set","p":"payload","to":"node-red-device-auto1"}],"action":"","property":"","from":"","to":"","reg":false,"x":274,"y":762,"wires":[["6deed747.921128"]]},{"id":"75b350a5.8a4cb","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":920,"y":741,"wires":[]},{"id":"b0141e4d.4febe","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":919,"y":773,"wires":[]},{"id":"40f9eb13.bf0614","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":710,"y":751,"wires":[["75b350a5.8a4cb"],["b0141e4d.4febe","107fc713.ef8039"]]},{"id":"316f2be2.ce90d4","type":"SmartObjects objects","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"update","inputtext":"","x":475,"y":399,"wires":[["852c8bf4.7ad378"]]},{"id":"a992a44d.566d58","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":922,"y":418,"wires":[]},{"id":"d655cc56.29aa3","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":922,"y":386,"wires":[]},{"id":"852c8bf4.7ad378","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":744,"y":399,"wires":[["d655cc56.29aa3"],["a992a44d.566d58","b9dd056a.4622f8"]]},{"id":"7bdf1a58.8420e4","type":"SmartObjects events","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"send","inputtext":"","x":470,"y":475,"wires":[["b84f17cf.47b0e8"]]},{"id":"58759d0b.a78a64","type":"SmartObjects events","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","functionselection":"sendfromdevice","inputtext":"","x":523.5555572509766,"y":552.1110897064209,"wires":[["99f17e6b.660e8"]]},{"id":"225aa85f.dda558","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":923,"y":495,"wires":[]},{"id":"7702d78d.88fd28","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":923,"y":463,"wires":[]},{"id":"b84f17cf.47b0e8","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":750,"y":477,"wires":[["7702d78d.88fd28"],["225aa85f.dda558","d82988c6.27d678"]]},{"id":"ecafad7f.13505","type":"debug","z":"7eca5e06.8135a","name":"OK","active":true,"console":"false","complete":"payload","x":921,"y":578,"wires":[]},{"id":"bfe6a685.401958","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":921,"y":546,"wires":[]},{"id":"99f17e6b.660e8","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":743,"y":553,"wires":[["bfe6a685.401958"],["ecafad7f.13505","8be41441.741be8"]]},{"id":"405967d2.bfa698","type":"SmartObjects analytics","z":"7eca5e06.8135a","name":"","mnuboconfig":"ec6f6c42.13909","searchtype":"SearchQuery","inputquery":"","x":460,"y":652,"wires":[["c656bd09.39a94","9ce667ed.631998"]]},{"id":"2698fc72.d96704","type":"debug","z":"7eca5e06.8135a","name":"Error","active":true,"console":"false","complete":"payload","x":921,"y":629,"wires":[]},{"id":"3704e552.c8fb1a","type":"debug","z":"7eca5e06.8135a","name":"rows","active":true,"console":"false","complete":"payload.rows","x":921,"y":661,"wires":[]},{"id":"c656bd09.39a94","type":"switch","z":"7eca5e06.8135a","name":"errorCode is not null","property":"payload.errorCode","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","outputs":2,"x":706,"y":650,"wires":[["2698fc72.d96704"],["3704e552.c8fb1a"]]},{"id":"cc161a0d.33e9e8","type":"function","z":"7eca5e06.8135a","name":"Create User","func":"msg.payload =\n{\n\t\"username\": \"node-red-auto1@test.com\",\n\t\"x_password\": \"12345678\"\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":320.4444694519043,"y":161.88886642456055,"wires":[["97ea51fd.6815b"]]},{"id":"ec0469f8.13fb98","type":"function","z":"7eca5e06.8135a","name":"Create an Object","func":"msg.payload = {\n\t\"x_device_id\": \"node-red-device-auto1\",\n\t\"x_object_type\": \"test\",\n\t\"x_owner\": {\n\t\t\"username\": \"node-red-auto1@test.com\"\n\t}\n};\nreturn msg;","outputs":1,"noerr":0,"x":290.4444465637207,"y":324.11110496520996,"wires":[["65405b9.f9abfa4"]]},{"id":"b9dd056a.4622f8","type":"function","z":"7eca5e06.8135a","name":"Send an event","func":"msg.payload = [{\n\t\"x_object\": {\"x_device_id\": \"node-red-device-auto1\"},\n\t\"x_event_type\": \"event_type_test\",\n\t\"x_timestamp\": \"2015-01-22T00:01:25-02:00\",\n\t\"x_latitude\": 57.876,\n\t\"x_longitude\": 57.876,\n\t\"temperature\": 25.6\n}];\nreturn msg;","outputs":1,"noerr":0,"x":277.11113357543945,"y":477.44441986083984,"wires":[["7bdf1a58.8420e4"]]},{"id":"8be41441.741be8","type":"function","z":"7eca5e06.8135a","name":"Count Events","func":"msg.payload = {\n\t\"from\": \"event\",\n\t\"select\": [{\n\t\t\"count\": \"*\"\n\t}]\n};\nreturn msg;","outputs":1,"noerr":0,"x":228.22222518920898,"y":654.1111354827881,"wires":[["405967d2.bfa698"]]},{"id":"a71ae1b7.58e52","type":"function","z":"7eca5e06.8135a","name":"Update owner","func":"msg.payload = \"node-red-auto1@test.com, { \\\n\t\\\"x_registration_latitude\\\": 45.223, \\\n\t\\\"x_registration_longitude\\\": 73.234 \\\n}\";\nreturn msg;","outputs":1,"noerr":0,"x":290.44443130493164,"y":239.6666488647461,"wires":[["55802a44.aa7fd4"]]},{"id":"fa88f7b.f057708","type":"function","z":"7eca5e06.8135a","name":"Update Object","func":"msg.payload=\"node-red-device-auto1, { \\\n\t\\\"x_object_type\\\": \\\"test2\\\" \\\n}\";\nreturn msg;","outputs":1,"noerr":0,"x":287.11111068725586,"y":400.7777976989746,"wires":[["316f2be2.ce90d4"]]},{"id":"d82988c6.27d678","type":"function","z":"7eca5e06.8135a","name":"Send an Evet FROM the object","func":"msg.payload = \"node-red-device-auto1, [{           \\\n\t\\\"x_event_type\\\": \\\"event_type_test\\\",          \\\n\t\\\"x_timestamp\\\": \\\"2015-01-22T00:01:25-02:00\\\", \\\n\t\\\"x_latitude\\\": 57.876,                         \\\n\t\\\"x_longitude\\\": 57.876,                        \\\n\t\\\"temperature\\\": 15.2                           \\\n}]\";\n\nreturn msg;","outputs":1,"noerr":0,"x":249.33332443237305,"y":550.7777557373047,"wires":[["58759d0b.a78a64"]]}]
```
